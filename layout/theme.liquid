<!doctype html>
<html
  class="no-js{% if request.design_mode %} shopify-design-mode{% endif %}"
  lang="{{ request.locale.iso_code }}"
>
  <head>
    {%- render 'stylesheets' -%}

    {%- if settings.favicon != blank -%}
      <link
        rel="icon"
        type="image/png"
        href="{{ settings.favicon | image_url: width: 32, height: 32 }}"
      >
    {%- endif -%}

    {% comment %} This a way to wait for main content to load when navigating to a new page so that the view transitions can work consistently {% endcomment %}
    <link
      rel="expect"
      href="#MainContent"
      blocking="render"
      id="view-transition-render-blocker"
    >

    {%- render 'meta-tags' -%}
    {%- render 'fonts' -%}
    {%- render 'scripts' -%}
    {%- render 'theme-styles-variables' -%}
    {%- render 'color-schemes' -%}

    {% if request.design_mode %}
      {%- render 'theme-editor' -%}
    {% endif %}

    {{ 'swiper.css' | asset_url | stylesheet_tag }}
    {{ 'style.css' | asset_url | stylesheet_tag }}

    {{ content_for_header }}
  </head>

  <body class="page-width-{{ settings.page_width }} card-hover-effect-{{ settings.card_hover_effect }}">
    {% render 'skip-to-content-link', href: '#MainContent', text: 'accessibility.skip_to_text' %}
    <div id="header-group">
      {% sections 'header-group' %}
    </div>

    <main
      id="MainContent"
      class="content-for-layout"
      role="main"
      data-page-transition-enabled="{{ settings.page_transition_enabled }}"
      data-product-transition="{{ settings.transition_to_main_product }}"
      data-template="{{ template }}"
    >
      {{ content_for_layout }}
    </main>

    {% sections 'footer-group' %}

    {% # theme-check-disable ParserBlockingScript %}
    <script src="{{ 'critical.js' | asset_url }}"></script>
    {% # theme-check-enable ParserBlockingScript %}

    {% render 'search-modal' %}

    {% if settings.quick_add or settings.mobile_quick_add %}
      {% render 'quick-add-modal' %}
    {% endif %}
    <script src="{{ 'swiper.js' | asset_url }}"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        var swiperEl = document.querySelector('.swiper');
        new Swiper(swiperEl, {
          slidesPerView: 'auto',
          spaceBetween: 20,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
        });
      });

      window.addEventListener('load', function () {
        // 1) find your popup content by the class you entered in the block ("modal-class")
        var content = document.querySelector('.modal-discount');
        if (!content) return;

        // 2) find the modal wrapper (usually <modal-dialog id="PopupModal-XXXX">)
        var modalWrapper = content.closest('[id]');
        var id = modalWrapper ? modalWrapper.id : null;

        // optional: show only once per session.  Set to true to show every load.
        var ALWAYS_OPEN = true;
        var KEY = 'popup-opened:' + (id || 'modal-discount');
        if (!ALWAYS_OPEN && sessionStorage.getItem(KEY)) return;

        // 3) try to click the official opener that targets this modal ID
        var selectors = [];
        if (id) {
          selectors.push(
            `[aria-controls="${id}"]`,
            `[data-modal="#${id}"]`,
            `[data-modal="${id}"]`,
            `[data-open-modal="#${id}"]`,
            `[data-open-modal="${id}"]`,
            `[data-open-popup="#${id}"]`,
            `[data-open-popup="${id}"]`
          );
        }
        // fallback: open the first link/button inside the popup-link block
        selectors.push('.popup-link a[role="button"]', '.popup-link button', '.popup-link a');

        var opener = null;
        for (var i = 0; i < selectors.length && !opener; i++) {
          opener = document.querySelector(selectors[i]);
        }

        if (opener) {
          opener.click(); // uses themeâ€™s own open behavior
          if (!ALWAYS_OPEN) sessionStorage.setItem(KEY, '1');
          return;
        }

        // 4) ultimate fallbacks if no opener was found (covers unusual themes)
        if (modalWrapper) {
          var nativeDialog = modalWrapper.closest('dialog');
          if (nativeDialog && nativeDialog.showModal) {
            nativeDialog.showModal();
          } else {
            modalWrapper.classList.add('is-open', 'open', 'active');
            document.documentElement.classList.add('scroll-lock', 'overflow-hidden');
            document.body.classList.add('scroll-lock', 'overflow-hidden');
          }
          if (!ALWAYS_OPEN) sessionStorage.setItem(KEY, '1');
        }
      });
    </script>
  </body>
</html>
